# name: SFU Timetable Monitor

# on:
#   schedule:
#     - cron: '*/10 6-23 * * *'  # –ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç —Å 6:00 –¥–æ 23:00
#   workflow_dispatch:

# jobs:
#   check-timetable:
#     runs-on: ubuntu-latest
#     steps:
#       - name: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª–æ—Å—å –ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
#         id: check
#         run: |
#           response=$(curl -s "https://edu.sfu-kras.ru/timetable/groups/autocomplete/%D0%9A%D0%9823")
#           echo "–û—Ç–≤–µ—Ç –æ—Ç API: $response"
          
#           if [[ "$response" == *","* ]]; then
#             echo "timetable_found=true" >> $GITHUB_ENV
#             echo "‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ!"
#           else
#             echo "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –µ—â—ë –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ."
#             exit 1  # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º job, workflow –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
#           fi

#       - name: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
#         if: env.timetable_found == 'true'
#         run: |
#           url="https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage"
#           message="üéâ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≥—Ä—É–ø–ø –ö–ò23 –≤—ã–ª–æ–∂–µ–Ω–æ!\n\nüëâ https://edu.sfu-kras.ru/timetable"
#           response=$(curl -s -X POST "$url" \
#             -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
#             -d text="$message")
          
#           echo "–û—Ç–≤–µ—Ç Telegram: $response"
          
#           if echo "$response" | grep -q '"ok":false'; then
#             echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
#             exit 1
#           fi

#       - name: –û—Ç–∫–ª—é—á–∞–µ–º workflow –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
#         if: env.timetable_found == 'true'
#         run: |
#           echo "–û—Ç–∫–ª—é—á–∞–µ–º workflow –Ω–∞–≤—Å–µ–≥–¥–∞..."
#           curl -X PATCH \
#             -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
#             -H "Accept: application/vnd.github.v3+json" \
#             "https://api.github.com/repos/${{ github.repository }}/actions/workflows/timetable-monitor.yml/disable"
